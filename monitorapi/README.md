# Requirements
Java 1.8 or above.
Docker
Maven (or you can use mvnw which is in this repo).

# Pre-Install Notes
The application uses the following parameters:

DB_USERNAME
DB_PASSWORD
DB_HOST
DB_PORT
DB_USESSL
DB_NAME
SECRETFILENAME

DB_USERNAME and DB_NAME **must** be set in order for the build to function correctly. To assist in this two (4) helper files have been included:
	
	For *Nix:	setEnv
				vars
	For Windows:	setEnv.cmd
				vars.cmd

			
**Before executing any build**, edit the requisite file (vars for *Nix or vars.cmd for Windows) for your system providing the necessary values. When building locally you can use the setEnv file for ease of use.

When building using the docker-swarm.yml file: Edit the swarm file so that it contains the needed values before using it in execution.

Also, docker secrets is used by the application to retrieve the database password and username. Please create the following docker secrets:

	 **kioskconfigsettings_VER** : Versioned JSON settings object. VER at the end is replaced with the particular version number of the JSON settings. The current 1.0 structure is as follows:-
	 
	 { "databaseUsername":"name", "databasePassword":"password" }
	 
	 **databaseUsername**: contains the database username.
	 **databasePassword**: contains the Base 64 encoding of the database password.
	 
**Reminder**: To use docker secrets your docker must be running in swarm mode.
e.g for the password thisIsTheDBPassword:

	docker swarm init
	echo { "databaseUsername":"theUserName", "databasePassword":"dGhpc0lzVGhlREJQYXNzd29yZA==" } |docker secret create kioskconfigsettings_1.0 -
	
If you run this application outside of docker you must supply it with the database password if one has been set. This can be done via the environment variable **DB_PASSWORD** or the command line option **DB_PASSWORD**. Both mechanisms require the password to be Base64 encoded. 

e.g for password thisIsTheDBPassword:
	
	
	*Nix: export DB_PASSWORD=dGhpc0lzVGhlREJQYXNzd29yZA==
	Windows: SET DB_PASSWORD=dGhpc0lzVGhlREJQYXNzd29yZA==

# Install notes
Execute the commands from the directory this file resides. You can use **mvn** if you have maven installed or use **mvnw** if you don't.
	
To package:

	mvn clean
	mvn package

	
To run via command line using environment values:

	java -jar target/swagger-spring-1.0.0.jar
	
To run via command line using arguments:

	java -jar target/swagger-spring-1.0.0.jar --DB_USERNAME=<USER> --DB_PASSWORD=<PASSWORD> --DB_HOST=<HOST> --DB_PORT=<PORT> --DB_USESSL=<BOOLEAN> --DB_NAME=<DATBASE NAME>

	Example:

	java -jar target/swagger-spring-1.0.0.jar --DB_USERNAME=dbUser --DB_PASSWORD=Password1 --DB_HOST=db.test1.int.qless.com --DB_PORT=3306  --DB_USESSL=false --DB_NAME=test1_qless
	
**Note**: The port used exposed by the service is 8080.

To build docker image:
	
	mvn install dockerfile:build

**After** the successful docker build we can run the container.
	
To run docker container:

	docker run --env-file=variables.env -p 9000:8080 -t qless/kioskconfig --name kioskconfig

**NOTE**: It is better to run this via a docker compose script like below:

	docker-compose up -d --no-recreate --remove-orphans
	
Using the above will cause the application to look for the database password in an environment variable. To use docker secrets execute the following instead:

	docker stack deploy --compose-file=docker-compose.yml kioskconfig

**NOTE**: The docker-compose script also uses port 9000 on the host.

**NOTE**: When the application is run via docker, DB Password and DB Username are selected in this order:
	1. COMMAND LINE ARGUMENT
	2. DOCKER SECRET
	3. ENVIRONMENT VARIABLE 

# Swagger generated server

Spring Boot Server 


## Overview  
This server was generated by the [swagger-codegen](https://github.com/swagger-api/swagger-codegen) project.  
By using the [OpenAPI-Spec](https://github.com/swagger-api/swagger-core), you can easily generate a server stub.  
This is an example of building a swagger-enabled server in Java using the SpringBoot framework.  

The underlying library integrating swagger to SpringBoot is [springfox](https://github.com/springfox/springfox)  

Start your server as an simple java application  

You can view the api documentation in swagger-ui by pointing to  
http://localhost:8080/  

Change default port value in application.properties